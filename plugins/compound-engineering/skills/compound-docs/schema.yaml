# Crossfunction Documentation Schema
# This schema MUST be validated before writing any documentation file

required_fields:
  module:
    type: string
    description: "Module/area of Crossfunction (e.g., 'Client GUI', 'RAG Pipeline', 'Edge Functions')"
    examples:
      - "Client GUI"
      - "RAG Pipeline"
      - "Edge Functions"
      - "Agent Platform"
      - "PMM Pipeline"
      - "Docker Infrastructure"

  date:
    type: string
    pattern: '^\d{4}-\d{2}-\d{2}$'
    description: "Date when this problem was solved (YYYY-MM-DD)"

  problem_type:
    type: enum
    values:
      - build_error
      - test_failure
      - runtime_error
      - performance_issue
      - database_issue
      - security_issue
      - ui_bug
      - integration_issue
      - logic_error
      - developer_experience
      - workflow_issue
      - best_practice
      - documentation_gap
      - mcp_tool_issue
      - edge_function_error
      - rls_policy_issue
      - docker_config_issue
      - agent_prompt_issue
      - skill_execution_error
      - env_var_issue
      - schema_drift
      - pipeline_failure
    description: "Primary category of the problem"

  component:
    type: enum
    values:
      - react_component
      - react_hook
      - react_context
      - react_page
      - tanstack_query
      - supabase_edge_function
      - supabase_migration
      - supabase_rls_policy
      - supabase_rpc
      - rag_service
      - mcp_server
      - mcp_tool
      - agent_config
      - skill_prompt
      - docker_config
      - docker_compose
      - ci_workflow
      - nginx_config
      - linear_integration
      - apify_integration
      - firecrawl_integration
      - mkdocs_site
      - knowledge_pipeline
      - signal_extraction
    description: "Crossfunction component involved"

  symptoms:
    type: array[string]
    min_items: 1
    max_items: 5
    description: "Observable symptoms (error messages, visual issues, crashes)"
    examples:
      - "Edge Function returns empty JSONB for positioning data"
      - "VITE_SUPABASE_URL is undefined at runtime in Docker"
      - "RAG query returns zero-vector results"

  root_cause:
    type: enum
    values:
      - missing_rls_policy
      - schema_drift
      - env_var_missing
      - env_var_wrong_location
      - mcp_config_error
      - docker_network_issue
      - cors_issue
      - vite_env_not_in_all_three
      - edge_function_schema_mismatch
      - stale_linear_index
      - alpine_ipv6_resolution
      - missing_mkdocs_nav_entry
      - kitchen_sink_commit
      - worktree_not_isolated
      - missing_association
      - missing_index
      - wrong_api
      - scope_issue
      - async_timing
      - memory_leak
      - config_error
      - logic_error
      - test_isolation
      - missing_validation
      - missing_permission
      - missing_workflow_step
      - inadequate_documentation
      - missing_tooling
      - incomplete_setup
    description: "Fundamental cause of the problem"

  resolution_type:
    type: enum
    values:
      - code_fix
      - migration
      - config_change
      - test_fix
      - dependency_update
      - environment_setup
      - workflow_improvement
      - documentation_update
      - tooling_addition
      - rls_policy_fix
      - edge_function_fix
      - docker_config_fix
      - agent_prompt_fix
      - skill_update
      - env_var_fix
      - schema_alignment
      - linear_index_refresh
      - mkdocs_nav_update
      - claude_md_update
    description: "Type of fix applied"

  severity:
    type: enum
    values:
      - critical
      - high
      - medium
      - low
    description: "Impact severity"

optional_fields:
  supabase_table:
    type: string
    description: "Supabase table involved (e.g., 'pmm_positioning_anchors')"

  edge_function:
    type: string
    description: "Edge Function name (e.g., 'generate-positioning')"

  linear_issue:
    type: string
    description: "Linear issue identifier (e.g., 'CF-123')"

  adr_reference:
    type: string
    description: "Related ADR (e.g., 'ADR-018')"

  prd_reference:
    type: string
    description: "Related PRD (e.g., 'PRD-ONESEC-FIRST-ACCOUNT')"

  related_components:
    type: array[string]
    description: "Other components that interact with this issue"

  tags:
    type: array[string]
    max_items: 8
    description: "Searchable keywords (lowercase, hyphen-separated)"
    examples:
      - "supabase"
      - "docker"
      - "rls-policy"
      - "edge-function"

validation_rules:
  - "module must be a valid Crossfunction module name"
  - "date must be in YYYY-MM-DD format"
  - "problem_type must match one of the enum values"
  - "component must match one of the enum values"
  - "symptoms must be specific and observable (not vague)"
  - "root_cause must be the ACTUAL cause, not a symptom"
  - "resolution_type must match one of the enum values"
  - "severity must match one of the enum values"
  - "tags should be lowercase, hyphen-separated"

# Example valid front matter:
# ---
# module: Client GUI
# date: 2026-02-10
# problem_type: env_var_issue
# component: docker_config
# symptoms:
#   - "VITE_SUPABASE_URL is undefined at runtime in Docker build"
#   - "API calls fail silently with empty base URL"
# root_cause: vite_env_not_in_all_three
# resolution_type: env_var_fix
# severity: high
# supabase_table: null
# edge_function: null
# linear_issue: CF-456
# adr_reference: null
# prd_reference: null
# tags: [vite, env-var, docker, frontend]
# ---
